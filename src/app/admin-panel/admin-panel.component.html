<app-nav-bar></app-nav-bar>
<div class="banner-solde p-4 text-center bg-danger text-white rounded">
  <h2>üî• Soldes Exceptionnelles üî•</h2>
  <p>Profitez de r√©ductions incroyables sur nos lunettes !</p>
</div>
<img src="../../../assets/home/footer/banner-home.png" class="banner-home" />


<section class="main-section">
  <div class="container mt-4">
    <h1 class="title">DASHBOARD NOVOSTRAT</h1>
    <button (click)="accessDataFrameStreamlit()" class="access-btn-power-bi">Acc√©der au streamlit</button>
    <div>
      <div class="progress">
        
        <div class="progress-bar" role="progressbar"
             [style.width.%]="(prescriptions.traitees / prescriptions.total) * 100"
             aria-valuemin="0" aria-valuemax="100">
          {{ (prescriptions.traitees / prescriptions.total) * 100 | number: '1.0-0' }}% des prescriptions trait√©es
        </div>
  
      </div>
    </div>
    <div class="row text-center">
      <div class="col-md-3">
   
        <div class="card shadow-sm p-3">
          <p><i class="fas fa-user"></i> Total Clients</p>
          <p>Plus d'infos</p>
          <h4>{{count_clients}}</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <p><i class="fas fa-glasses"></i> Total Montures</p>
          <p>Plus d'infos</p>
          <h4>{{count_montures}}</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <p><i class="fas fa-shopping-cart"></i> Total Paniers</p>
          <p>Plus d'infos</p>
          <h4>{{count_baskets}}</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <p><i class="fas fa-pills"></i> Total Prescriptions</p>
          <p>Plus d'infos</p>
          <h4>{{count_prescriptions}}</h4>
        </div>
      </div>
    </div>
  </div>
  
  
  <div class="center-index">
    <div class="char-container d-flex justify-content-center align-items-center h-50 w-50">
      <canvas id="montureChart">{{montureChart}}</canvas>
    </div>

    <div class="char-container d-flex justify-content-center align-items-center h-50 w-50">
      <canvas id="orderStatusChart">{{orderStatusChart}}</canvas>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm p-3">
      <p><i class="fas fa-glasses"></i> Total Verres</p>
      <h4>{{count_glasses}}</h4>
    </div>
  </div>

  <div class="center-index">
    <div class="char-container d-flex justify-content-center align-items-center h-50 w-50">
      <canvas id="clientChart">{{clientChart}}</canvas>
    </div>

    <div class="char-container d-flex justify-content-center align-items-center h-50 w-50">
      <canvas id="verreChart">{{verreChart}}</canvas>
    </div>
  </div>

  <div class="center-index">    
    <div class="char-container d-flex justify-content-center align-items-center h-50 w-50">
      <canvas id="commandChart">{{commandChart}}</canvas>
    </div>
  </div>

  <h1 class="title">AJOUTER des Nouveaux Verres</h1>
  <mat-horizontal-stepper linear #stepper>
    <!-- √âtape 1 -->
    <mat-step [stepControl]="stepperVerre.controls['type']">
      <form [formGroup]="stepperVerre">
        <h3>Informations g√©n√©rales</h3>
        <mat-form-field appearance="outline">
          <mat-label>Type</mat-label>
          <input matInput formControlName="type" placeholder="Ex: Progressif">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Indice de R√©fraction</mat-label>
          <input matInput type="number" formControlName="indiceRefraction" placeholder="Ex: 1.5">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Traitements</mat-label>
          <input matInput formControlName="traitements" placeholder="Ex: Anti-reflet">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Teinte</mat-label>
          <input matInput formControlName="teinte" placeholder="Ex: Gris">
        </mat-form-field>
  
        <button mat-button matStepperNext>Suivant</button>
      </form>
    </mat-step>
  
    <!-- √âtape 2 -->
    <mat-step>
      <form [formGroup]="stepperVerre">
        <h3>Compatibilit√© et caract√©ristiques</h3>
        <mat-form-field appearance="outline">
          <mat-label>Compatibilit√©</mat-label>
          <input matInput formControlName="compatibilite" placeholder="Ex: Adapt√© aux montures m√©tal">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Cat√©gorie de Protection</mat-label>
          <input matInput formControlName="categorieProtection" placeholder="Ex: UV400">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>S√©curit√©</mat-label>
          <input matInput formControlName="securite" placeholder="Ex: Anti-rayure">
        </mat-form-field>
  
        <button mat-button matStepperPrevious>Pr√©c√©dent</button>
        <button mat-button matStepperNext>Suivant</button>
      </form>
    </mat-step>
  
    <!-- √âtape 3 -->
    <mat-step>
      <form [formGroup]="stepperVerre">
        <h3>Prix et stock</h3>
        <mat-form-field appearance="outline">
          <mat-label>Prix (‚Ç¨)</mat-label>
          <input matInput type="number" formControlName="prix" placeholder="Ex: 120">
        </mat-form-field>
  
        <mat-form-field appearance="outline">
          <mat-label>Stock</mat-label>
          <input matInput type="number" formControlName="stock" placeholder="Ex: 50">
        </mat-form-field>
  
        <mat-slide-toggle formControlName="solaire">Solaire</mat-slide-toggle>
  
        <button mat-button matStepperPrevious>Pr√©c√©dent</button>
        <button mat-button matStepperNext>Suivant</button>
      </form>
    </mat-step>
  
    <!-- √âtape 4 : R√©sum√© -->
    <mat-step>
      <h3>R√©sum√©</h3>
      <p><strong>Type:</strong> {{ stepperVerre.value.type }}</p>
      <p><strong>Indice de R√©fraction:</strong> {{ stepperVerre.value.indiceRefraction }}</p>
      <p><strong>Traitements:</strong> {{ stepperVerre.value.traitements }}</p>
      <p><strong>Teinte:</strong> {{ stepperVerre.value.teinte }}</p>
      <p><strong>Compatibilit√©:</strong> {{ stepperVerre.value.compatibilite }}</p>
      <p><strong>Cat√©gorie de Protection:</strong> {{ stepperVerre.value.categorieProtection }}</p>
      <p><strong>S√©curit√©:</strong> {{ stepperVerre.value.securite }}</p>
      <p><strong>Prix:</strong> {{ stepperVerre.value.prix }}‚Ç¨</p>
      <p><strong>Stock:</strong> {{ stepperVerre.value.stock }}</p>
      <p><strong>Solaire:</strong> {{ stepperVerre.value.solaire ? 'Oui' : 'Non' }}</p>
  
      <button mat-button matStepperPrevious>Pr√©c√©dent</button>
      <button mat-button (click)="submitVerre()">Confirmer</button>
    </mat-step>
  </mat-horizontal-stepper>
  
  <div class="container mt-4">
    <div class="row text-center">
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <h4>Formulaire 1 </h4>

        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <h4>Division 2</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <h4>Division 3</h4>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card shadow-sm p-3">
          <h4>Division 4</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="" style="display: block;margin: auto;">
    <div class="mt-5">
      <h4>Top  des Lunettes au meilleur Prix</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Mod√®le</th>
            <th>Ventes</th>
            <th>Modele</th>
            <th>Materiau</th>
            <th>Stock</th>
            <th>Teinte</th>
            <th>Traitements</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let lunettes of topLunettes; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ lunettes.Marque }}</td>
            <td>{{ lunettes.Prix }} ‚Ç¨</td>
            <td>{{ lunettes.Modele }} </td>
            <td>{{ lunettes.Materiau }} </td>
            <td>{{ lunettes.Stock }} </td>
            <td>{{ lunettes.Teinte }} </td>
            <td>{{ lunettes.Traitements }} </td>
          </tr> 
        </tbody>
      </table>
    </div>
  </div>

  <div class="container mt-4">
    <h2 class="text-center mb-4"> Panneau Admin</h2>
    <div class="text-center mb-4">
      <h4>üìã Tables disponibles :</h4>
      <div class="btn-group">
        <button 
          *ngFor="let table of tables" 
          class="btn btn-outline-primary"
          (click)="loadTableData(table)">
          {{ table }}
        </button>
      </div>
    </div>

    <div *ngIf="selectedTable">
      <h3 class="text-primary text-center">üìå Table: {{ selectedTable }}</h3>

      <div class="table-responsive mt-3">
        <table class="table table-striped table-bordered">
          <thead class="table-dark">
            <tr>
              <th *ngFor="let key of tableData[0] | keyvalue">{{ key.key }}</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of tableData">
              <td *ngFor="let key of row | keyvalue">{{ key.value }}</td>
              <td>
                <button class="btn btn-danger btn-sm" (click)="deleteRow(row._id)">üóë Supprimer</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center mt-4">
        <button class="btn btn-success" (click)="showAddForm()">‚ûï Ajouter une ligne</button>
      </div>

      <div *ngIf="showForm" class="card mt-3 p-3">
        <h3 class="text-center">üìù Ajouter une nouvelle ligne</h3>
        <div class="mb-3" *ngFor="let key of tableData[0] | keyvalue">
          <label class="form-label">{{ key.key }}</label>
          <input [(ngModel)]="newRow[key.key]" class="form-control">
        </div>
        <button class="btn btn-primary mt-2" (click)="addRow()">‚úÖ Enregistrer</button>
      </div>
    </div>

    <div *ngIf="tableData.length > 0" class="mt-5"> 
      <h3 class="text-center">üìä Visualisation des Donn√©es</h3>
      <canvas id="chartCanvas"></canvas>
    </div>
  </div>
</section>
